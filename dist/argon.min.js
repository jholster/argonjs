!function t(e,n,r){function o(s,u){if(!n[s]){if(!e[s]){var l="function"==typeof require&&require;if(!u&&l)return l(s,!0);if(i)return i(s,!0);throw new Error("Cannot find module '"+s+"'")}var c=n[s]={exports:{}};e[s][0].call(c.exports,function(t){var n=e[s][1][t];return o(n?n:t)},c,c.exports,t,e,n,r)}return n[s].exports}for(var i="function"==typeof require&&require,s=0;s<r.length;s++)o(r[s]);return o}({1:[function(t,e,n){var r,n;r={},r.Observable=t("./observable"),r.Renderer=t("./renderer"),r.Route=t("./route"),r.View=t("./view"),r.Socket=t("./client/socket"),r.ClientModel=t("./client/model"),r.Model=r.ClientModel,n=e.exports=r,"undefined"!=typeof window&&null!==window&&(window.Argon=n)},{"./client/model":2,"./client/socket":3,"./observable":5,"./renderer":6,"./route":7,"./view":8}],2:[function(t,e,n){var r,o,i,n,s,u={}.hasOwnProperty,l=function(t,e){function n(){this.constructor=t}for(var r in e)u.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},c=[].slice;r=t("../model"),i=t("./socket"),o=function(t){function e(){return s=e.__super__.constructor.apply(this,arguments)}return l(e,t),e.remote=new i,e.remote.on("ready",function(){return e.emit("ready")}),e.find=function(t,e,n){var r=this;return n||(n=e),this.remote.call(""+this.name+".find",[t,e],function(t,e){return n(t,e&&e.map(function(t){return new r(t)})||null)})},e.save=function(t,e){var n=this;return this.remote.call(""+this.name+".save",[t],function(t,r){return e(t,r&&new n(r)||null)})},e.remove=function(){var t,e,n;return t=2<=arguments.length?c.call(arguments,0,n=arguments.length-1):(n=0,[]),e=arguments[n++],this.remote.call(""+this.name+".remove",t,e)},e}.call(this,r),n=e.exports=o},{"../model":4,"./socket":3}],3:[function(t,e,n){var r,o,n,i={}.hasOwnProperty,s=function(t,e){function n(){this.constructor=t}for(var r in e)i.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t};r=t("../observable"),o=function(t){function e(t){var e;return"undefined"!=typeof location&&null!==location&&null==t&&(t=("https:"===location.protocol&&"wss://"||"ws://")+location.host),(e=this.constructor.pool[t])?e:(this.constructor.pool[t]=this,this.url=t,this.connect(),void 0)}return s(e,t),e.pool={},e.prototype.id=1,e.prototype.queue=[],e.prototype.sent={},e.prototype.connect=function(){var t=this;return this.connecting||"undefined"==typeof WebSocket||null===WebSocket?void 0:(console.log("connecting..."),this.connecting=!0,this.socket=new WebSocket(this.url),this.socket.onmessage=this.receive.bind(this),this.socket.onopen=function(){return console.log("connected"),t.connecting=!1,clearInterval(t.interval),t.interval=null,t.flush()},this.socket.onclose=function(){return console.log("closed"),t.connecting=!1,t.interval?void 0:t.interval=setInterval(t.connect.bind(t),2e3)})},e.prototype.call=function(t,e,n){var r,o;return null==e&&(e=[]),o={method:t,params:e,id:this.id++},r={request:o,cb:n},this.queue.push(r),this.flush(),this.timer=setTimeout(this.timeout.bind(this,r),2e3),this.update()},e.prototype.flush=function(){var t,e;for(e=[];this.socket.readyState===WebSocket.OPEN&&(t=this.queue.shift());)console.log("remote call",t.request),this.socket.send(JSON.stringify(t.request)),e.push(this.sent[t.request.id]=t);return e},e.prototype.receive=function(t){var e,n,r;return n=JSON.parse(t.data),n.id&&(r=n)?(e=this.sent[r.id])?(console.log("response",r),r.error&&console.error(r.error),delete this.sent[r.id],clearTimeout(this.timer),e.cb(r.error,r.result),this.update()):void 0:this.emit("notify",n)},e.prototype.timeout=function(t){return this.sent[t.request.id]?(console.log("timing out:",t.request.method),t.cb("timeout",null),delete this.sent[t.request.id],this.queue=this.queue.filter(function(e){return e!==t}),this.update()):void 0},e.prototype.update=function(){var t,e=this;return t=this.queue.length||Object.keys(this.sent).length,!this._waiting&&t?(this._waiting=new Date,this.emit("waiting"),this._waiting_timer=setTimeout(function(){return e._waiting?document.documentElement.dataset.state="waiting":void 0},250)):this._waiting&&!t?(console.log("waited for "+(new Date-this._waiting)+" msecs"),this._waiting=null,document.documentElement.dataset.state="idle",clearTimeout(this._waiting_timer),this.emit("ready")):void 0},e}(r),n=e.exports=o},{"../observable":5}],4:[function(t,e,n){var r,o,i,n;o=t("./argon"),i=t("./observable"),r=function(){function t(t){var e,n,r,o;if(t){if(t.id){if(null==(o=this.constructor)._identities&&(o._identities={}),e=this.constructor._identities[t.id]){for(n in t)r=t[n],e[n]=r;return e}this.constructor._identities[t.id]=this}for(n in t)r=t[n],this[n]=r}}return i.extend(t),t.field=function(t,e){return null==e&&(e={}),(null!=this._fields?this._fields:this._fields={id:{}})[t]=e},t.get=function(t,e){return"object"!=typeof t&&(t={id:t}),this.find(t,{limit:1},function(t,n){return e(t,n&&n[0]||null)})},t.prototype.save=function(t){return this.constructor.save(this,t)},t.prototype.remove=function(t){return this.constructor.remove({id:this.id},t)},t.prototype.readable=function(){return!0},t.prototype.writable=function(){return!0},t.prototype.toJSON=function(){var t,e;e={};for(t in this.constructor._fields)e[t]=this[t];return e},t}(),n=e.exports=r},{"./argon":1,"./observable":5}],5:[function(t,e,n){var r,n,o=[].slice;r=function(){function t(){}return t.extend=function(t){var e,n;n=[];for(e in this.prototype)n.push(t[e]=this.prototype[e]);return n},t.prototype.on=function(t,e,n){var r;return(null!=(r=null!=this.observers?this.observers:this.observers={})[t]?(r=null!=this.observers?this.observers:this.observers={})[t]:r[t]=[]).push(e),n?e.once=!0:void 0},t.prototype.once=function(t,e){return this.on(t,e,!0)},t.prototype.emit=function(){var t,e,n;return e=arguments[0],t=2<=arguments.length?o.call(arguments,1):[],console.log(this.name||this.constructor.name,"emits",e),null==this.observers&&(this.observers={}),null==(n=this.observers)[e]&&(n[e]=[]),this.observers[e]=this.observers[e].filter(function(e){return e.apply(null,t),!e.once})},t}(),n=e.exports=r},{}],6:[function(t,e,n){var r,n,o=[].slice;r=function(){function t(t,e){var n,r,i,s,u,l,c,a,p,h,f,d,v,m,y,g,b,w,_,k,q,x,N,S,E,L,T,O,C,M,A,D,j,H,P,W,I,J,R,B,$,F,V,z,G,K,Q,U,X,Y,Z,te,ee,ne,re=this;if(e&&this.push(e),t.nodeType===window.Node.ELEMENT_NODE){if(r=t.attributes,(k=null!=(D=r["data-if"])?D.value:void 0)&&!this.resolve(k))return this.molds.push(t),void 0;if((k=null!=(j=r["data-unless"])?j.value:void 0)&&this.resolve(k))return this.molds.push(t),void 0;if(k=null!=(z=r["data-each"])?z.value:void 0){for(U=k.split(" "),h=U[0],p=U[1],X=this.resolve(h)||[],x=0,L=X.length;L>x;x++)y=X[x],t.removeAttribute("data-each"),t.parentNode.insertBefore(l=t.cloneNode(!0)),e={},e[p]=y,this.constructor(l,e);return this.molds.push(t),void 0}if((k=null!=(Y=r["data-attr"])?Y.value:void 0)&&(Z=k.split(" "),r=Z[0],f=Z[1],t.setAttribute(r,null!=(te=this.resolve(f))?te:"")),k=null!=(ee=r["data-style"])?ee.value:void 0)for(ne=k.split(", "),N=0,T=ne.length;T>N;N++)p=ne[N],H=p.split(" "),r=H[0],f=H[1],t.style[r]=this.resolve(null!=f?f:"");if(k=null!=(P=r["data-class"])?P.value:void 0)for(W=k.split(", "),S=0,O=W.length;O>S;S++)if(p=W[S],I=p.split(" "),c=I[0],f=I[1],f)t.classList[this.resolve(f)&&"add"||"remove"](c);else if(w=this.resolve(c),w instanceof Array)for(E=0,C=w.length;C>E;E++)c=w[E],t.classList.add(c);else if("object"==typeof w)for(c in w)i=w[c],t.classList[i&&"add"||"remove"](c);else t.classList.add(w);if((k=null!=(J=r["data-route"])?J.value:void 0)&&(R=k.split(" "),q=R[0],g=2<=R.length?o.call(R,1):[],g=g.map(this.resolve.bind(this)),_=this.resolve(q),b=_.reverse(g),m=this.get("navigate"),t.addEventListener("click",function(t){return t.preventDefault(),m(b)},!0),"A"===t.tagName&&t.setAttribute("href",b)),(k=null!=(B=r["data-event"])?B.value:void 0)&&($=k.split(" "),v=$[0],f=$[1],n=3<=$.length?o.call($,2):[],n=n.map(function(t){return re.resolve(t)}),a=this.resolve(f),s=function(e){var r,i,s,u,l;if("submit"===v){for(e.preventDefault(),i=e.target,r={},l=i.elements,u=0,s=l.length;s>u;u++)t=l[u],t.name&&(r[t.name]=t.value);return a.apply(null,[r].concat(o.call(n),[e]))}return a.apply(null,o.call(n).concat([e]))},t.addEventListener(v,s,!0)),f=null!=(F=r["data-text"])?F.value:void 0)t.textContent=null!=(V=this.resolve(f))?V:"";else if(f=null!=(G=r["data-html"])?G.value:void 0)t.innerHTML=null!=(K=this.resolve(f))?K:"";else for(Q=t.childNodes,A=0,M=Q.length;M>A;A++)u=Q[A],this.constructor(u)}for(e&&this.pop();d=this.molds.pop();)d.parentNode.removeChild(d)}return t.prototype.stack=[],t.prototype.push=function(t){return this.stack.unshift(t)},t.prototype.pop=function(){return this.stack.shift()},t.prototype.get=function(t){var e,n,r,o,i;for(i=this.stack,r=0,o=i.length;o>r;r++)if(e=i[r],n=e[t],"undefined"!=typeof n)return"function"==typeof n&&n.bind(e)||n;return console.log("not found from stack",t,this.stack)},t.prototype.resolve=function(t){var e,n,r,o,i,s;if(o=t.split(".")){for(n=this.get(o.shift()),i=0,s=o.length;s>i;i++)e=o[i],null!=n&&(r=n,n=n[e]);return null==n&&console.log("cannot resolve keypath "+t),"function"==typeof n&&r&&n.bind(r)||n}},t.prototype.molds=[],t}(),n=e.exports=r},{}],7:[function(t,e,n){var r,n;r=function(){function t(t,e){var n;this.pattern=t,this.view=e,n=this.pattern.replace(/\?/g,"([^/]+)").replace(/\*/g,"(.*)"),this.re=new RegExp("^"+n+"$")}return t.prototype.reverse=function(t){return this.pattern.replace(/[\?\*]/,function(){return t.shift()})},t.prototype.match=function(t){var e;return(e=t.match(this.re))?e.slice(1):void 0},t}(),n=e.exports=r},{}],8:[function(t,e,n){var r,o,i,s,n,u,l={}.hasOwnProperty,c=function(t,e){function n(){this.constructor=t}for(var r in e)l.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t};i=t("./route"),o=t("./renderer"),r=t("./observable"),s=function(e){function n(){return u=n.__super__.constructor.apply(this,arguments)}return c(n,e),n.prototype.root="/",n.prototype.current=null,n.prototype.routes={},n.prototype.user=null,n.route=function(t,e){var n;return n=(null!=e?e.as:void 0)||this.name,this.prototype.routes[n]=new i(this.prototype.root+t,new this)},n.prototype.start=function(){var t=this;return window.onpopstate=function(){return t.dispatch(location.pathname)}},n.prototype.navigate=function(t){return t!==location.pathname&&history.pushState(null,"",t),this.dispatch(t)},n.prototype.reload=function(){return this.dispatch(location.pathname)},n.prototype.dispatch=function(t,e){var n,r,o,i,s;s=this.routes;for(r in s)if(i=s[r],o=i.match(t))return this.current=i.view,this.emit("view"),n=function(){var t;return(t=i.view).view.apply(t,o)},!e&&n()||n;throw"add .* as last route for 404 ("+t+")"},n.prototype.render=function(t){var e,n,r,i,s,u,l;for(e in t){for(r=t[e],i=document.querySelector("#template-"+r),e=document.querySelector("#"+(e||"main"));n=e.lastChild;)e.removeChild(n);if(i.content instanceof DocumentFragment)e.appendChild(i.content.cloneNode(!0));else for(l=i.childNodes,s=0,u=l.length;u>s;s++)n=l[s],e.appendChild(n.cloneNode(!0));new o(e,this)}return this.emit("rendered")},(new(t("./client/socket"))).on("notify",function(t){var e,n,r,o,i,s,u,l,c,a;if("livereload"===t.namespace){if(r=t,e=null!=(l=r.path.match(/\.[^\.]+$/))?l[0]:void 0,".css"===e)return n=document.querySelector('link[rel=stylesheet][href^="'+r.path+'"]'),null!=n?n.href=r.path+"?"+(new Date).getTime():void 0;if(".js"===e)return document.location.reload(!1);if(".html"===e){for(i=document.createElement("div"),i.innerHTML=r.content,c=i.querySelectorAll("template"),s=0,u=c.length;u>s;s++)o=c[s],null!=(a=document.getElementById(o.attributes.id))&&(a.innerHTML=o.innerHTML);return this.constructor.prototype.current.render()}}}),n}(r),n=e.exports=s},{"./client/socket":3,"./observable":5,"./renderer":6,"./route":7}]},{},[1]);